<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WSL开发环境的坑（不定期更新） | Lishunyang&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" type="image/png" href="/blog/favicon.png">
    <meta name="description" content="Lishunyang&#39;s Blog">
    <meta name="keywords" content="Javascript,HTTP,Nodejs,React">
    
    <link rel="preload" href="/blog/assets/css/0.styles.f6963c64.css" as="style"><link rel="preload" href="/blog/assets/js/app.6c59e45f.js" as="script"><link rel="preload" href="/blog/assets/js/2.7a1ed99b.js" as="script"><link rel="preload" href="/blog/assets/js/47.dd1b1ed6.js" as="script">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.f6963c64.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div data-v-ad494eec><ul class="container" data-v-37370f15 data-v-ad494eec><li class="title" data-v-37370f15><a href="/blog/" data-v-37370f15><img src="/blog/assets/img/avatar.cf743a85.jpg" class="avatar" data-v-37370f15>Lishunyang's Blog</a></li> <li class="item" data-v-37370f15><a href="/blog/about.html" data-v-37370f15>About</a></li></ul> <div class="main" data-v-ad494eec><div class="container" data-v-63da4bd6 data-v-ad494eec><div class="header" data-v-63da4bd6><h1 class="title" data-v-63da4bd6>WSL开发环境的坑（不定期更新）</h1> <div class="date-and-tags" data-v-63da4bd6><span class="date" data-v-63da4bd6>2021/2/15</span> <span class="tags" data-v-63da4bd6><span class="tag" data-v-63da4bd6>WSL</span><span class="tag" data-v-63da4bd6>windows</span><span class="tag" data-v-63da4bd6>development</span></span></div></div> <ul class="sidebar" data-v-63da4bd6><li class="sidebar-item" data-v-63da4bd6><a href="/2021/02/wsl2-dev-env.html#wsl与vpn的问题" data-v-63da4bd6>WSL与VPN的问题</a></li><li class="sidebar-item" data-v-63da4bd6><a href="/2021/02/wsl2-dev-env.html#failed-to-establish-a-socket-connection-to-proxies:-[&quot;proxy-127.0.0.1:7890&quot;]" data-v-63da4bd6>Failed to establish a socket connection to proxies: [&quot;PROXY 127.0.0.1:7890&quot;]</a></li><li class="sidebar-item" data-v-63da4bd6><a href="/2021/02/wsl2-dev-env.html#wsl如何使用cypress-gui" data-v-63da4bd6>WSL如何使用Cypress GUI</a></li></ul> <div class="content" data-v-63da4bd6><div class="content__default" data-v-63da4bd6><p>记录一些使用WSL做开发环境遇到的问题和解决办法，不定期更新。注意，这里的WSL都是指WSL2。</p> <blockquote><p>注：如果没有非用不可的理由，还是不建议使用WSL2，坑太多了，主要是网络方面的，非常影响效率</p></blockquote> <h2 id="wsl与vpn的问题"><a href="#wsl与vpn的问题" class="header-anchor">#</a> WSL与VPN的问题</h2> <ol><li>域名解析不正常</li></ol> <p>可以ping一下或者dig一下内网域名，看下能否正常解析ip，如果无法正常解析则属于此类。</p> <p>github上有一个相关的issue：<a href="https://github.com/microsoft/WSL/issues/5068" target="_blank" rel="noopener noreferrer">点击这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，原因似乎是宿主机连接VPN后，WSL没有把VPN的DNS resolver加上。</p> <p>倒是有一个非常简单粗暴稳定的解决办法，就是先连接VPN，再打开WSL。其他解决办法似乎都不够稳定。</p> <ol start="2"><li>http正常访问，https访问不了</li></ol> <p>比如执行 <code>curl http://www.mokahr.com</code> 可以得到正常响应，但是 <code>curl https://www.mokahr.com</code> 不行，那就属于此类。</p> <p>github上也有一个相关issue，<a href="https://github.com/microsoft/WSL/issues/4698" target="_blank" rel="noopener noreferrer">点击这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，原因是Path MTU discovery black问题，似乎是说windows和linux的MTU不一致，导致WSL发的包超过了路由的限制，但是路由又没有正确返回错误包，最终请求卡住了。</p> <p>解决办法是修改WSL的MTU，<code>sudo ip link set dev eth0 mtu 1400</code>，这个办法屡试不爽。完整的解释过程在<a href="https://github.com/microsoft/WSL/issues/4698#issuecomment-728967624" target="_blank" rel="noopener noreferrer">这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ol start="3"><li>开启VPN后WSL无法翻墙了</li></ol> <p>这个跟VPN有关，如果你使用的VPN是全局隧道，由于VPN路由表优先级最高，流量都会从VPN走，所以肯定是没法翻墙的。</p> <h2 id="failed-to-establish-a-socket-connection-to-proxies-proxy-127-0-0-1-7890"><a href="#failed-to-establish-a-socket-connection-to-proxies-proxy-127-0-0-1-7890" class="header-anchor">#</a> Failed to establish a socket connection to proxies: [&quot;PROXY 127.0.0.1:7890&quot;]</h2> <p>如果遇到这个错误，说明是代理地址不对，需要显式写出WSL2的虚拟网卡的ip地址。</p> <p>可以去powershell里执行ipconfig看到WSL的地址，然后覆盖WSL中的http_proxy和https_proxy，例如：</p> <div class="language- extra-class"><pre class="language-text"><code>http_proxy=http://172.21.0.1:7890
https_proxy=http://172.21.0.1:7890
</code></pre></div><h2 id="wsl如何使用cypress-gui"><a href="#wsl如何使用cypress-gui" class="header-anchor">#</a> WSL如何使用Cypress GUI</h2> <p>Cypress GUI使用了linux原生的GUI，默认情况下WSL无法启动，不过可以参考<a href="https://nickymeuleman.netlify.app/blog/gui-on-wsl2-cypress" target="_blank" rel="noopener noreferrer">这篇博客<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>解决。</p></div></div> <div class="comment" data-v-63da4bd6><Vssue data-v-63da4bd6></Vssue></div></div></div> <div class="container" data-v-2d129ad4 data-v-ad494eec>
  Designed by <a href="/about" data-v-2d129ad4>Lishunyang</a> | All right reserved
</div></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.6c59e45f.js" defer></script><script src="/blog/assets/js/2.7a1ed99b.js" defer></script><script src="/blog/assets/js/47.dd1b1ed6.js" defer></script>
  </body>
</html>
