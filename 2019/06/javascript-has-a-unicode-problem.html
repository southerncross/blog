<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>javascriptçš„unicodeé—®é¢˜ | Lishunyang&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" type="image/png" href="/blog/favicon.png">
    <meta name="description" content="Lishunyang&#39;s Blog">
    <meta name="keywords" content="Javascript,HTTP,Nodejs,React">
    
    <link rel="preload" href="/blog/assets/css/0.styles.102d8b8d.css" as="style"><link rel="preload" href="/blog/assets/js/app.a48c4f56.js" as="script"><link rel="preload" href="/blog/assets/js/2.e0432708.js" as="script"><link rel="preload" href="/blog/assets/js/36.920da182.js" as="script">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.102d8b8d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div data-v-ad494eec><ul class="container" data-v-26d88251 data-v-ad494eec><li class="title" data-v-26d88251><a href="/blog/" data-v-26d88251><img src="/blog/assets/img/avatar.cf743a85.jpg" class="avatar" data-v-26d88251>Lishunyang's Blog</a></li> <li class="item" data-v-26d88251><a href="/about.html" data-v-26d88251>About</a></li></ul> <div class="main" data-v-ad494eec><div class="container" data-v-63da4bd6 data-v-ad494eec><div class="header" data-v-63da4bd6><h1 class="title" data-v-63da4bd6>javascriptçš„unicodeé—®é¢˜</h1> <div class="date-and-tags" data-v-63da4bd6><span class="date" data-v-63da4bd6>2019/6/28</span> <span class="tags" data-v-63da4bd6><span class="tag" data-v-63da4bd6>javascript</span><span class="tag" data-v-63da4bd6>unicode</span></span></div></div> <ul class="sidebar" data-v-63da4bd6><li class="sidebar-item" data-v-63da4bd6><a href="/2019/06/javascript-has-a-unicode-problem.html#unicodeåŸºç¡€" data-v-63da4bd6>UnicodeåŸºç¡€</a></li><li class="sidebar-item" data-v-63da4bd6><a href="/2019/06/javascript-has-a-unicode-problem.html#è½¬ä¹‰åºåˆ—" data-v-63da4bd6>è½¬ä¹‰åºåˆ—</a></li><li class="sidebar-item" data-v-63da4bd6><a href="/2019/06/javascript-has-a-unicode-problem.html#æ•°ä¸€æ•°javascriptä¸­å­—ç¬¦ä¸²æœ‰å¤šå°‘ä¸ªunicodeç¬¦å·" data-v-63da4bd6>æ•°ä¸€æ•°Javascriptä¸­å­—ç¬¦ä¸²æœ‰å¤šå°‘ä¸ªUnicodeç¬¦å·</a></li><li class="sidebar-item" data-v-63da4bd6><a href="/2019/06/javascript-has-a-unicode-problem.html#æ•°ä¸€æ•°javascriptä¸­å­—ç¬¦ä¸²æœ‰å¤šå°‘ä¸ªébmpç¬¦å·" data-v-63da4bd6>æ•°ä¸€æ•°Javascriptä¸­å­—ç¬¦ä¸²æœ‰å¤šå°‘ä¸ªéBMPç¬¦å·</a></li><li class="sidebar-item" data-v-63da4bd6><a href="/2019/06/javascript-has-a-unicode-problem.html#å“ªäº›é•¿å¾—å¾ˆç›¸ä¼¼çš„ç¬¦å·" data-v-63da4bd6>å“ªäº›é•¿å¾—å¾ˆç›¸ä¼¼çš„ç¬¦å·</a></li><li class="sidebar-item" data-v-63da4bd6><a href="/2019/06/javascript-has-a-unicode-problem.html#å¥½å¤šä¸ªç»„åˆæ ‡è®°" data-v-63da4bd6>å¥½å¤šä¸ªç»„åˆæ ‡è®°</a></li><li class="sidebar-item" data-v-63da4bd6><a href="/2019/06/javascript-has-a-unicode-problem.html#å…¶ä»–ç±»å‹çš„ç¬¦å·" data-v-63da4bd6>å…¶ä»–ç±»å‹çš„ç¬¦å·</a></li><li class="sidebar-item" data-v-63da4bd6><a href="/2019/06/javascript-has-a-unicode-problem.html#åœ¨javascriptä¸­å°†å­—ç¬¦ä¸²åè¿‡æ¥" data-v-63da4bd6>åœ¨Javascriptä¸­å°†å­—ç¬¦ä¸²åè¿‡æ¥</a></li><li class="sidebar-item" data-v-63da4bd6><a href="/2019/06/javascript-has-a-unicode-problem.html#å­—ç¬¦ä¸²æ–¹æ³•ä¸­çš„unicodeé—®é¢˜" data-v-63da4bd6>å­—ç¬¦ä¸²æ–¹æ³•ä¸­çš„Unicodeé—®é¢˜</a></li><li class="sidebar-item" data-v-63da4bd6><a href="/2019/06/javascript-has-a-unicode-problem.html#unicodeå¯¹æ­£åˆ™è¡¨è¾¾å¼çš„å½±å“" data-v-63da4bd6>Unicodeå¯¹æ­£åˆ™è¡¨è¾¾å¼çš„å½±å“</a></li><li class="sidebar-item" data-v-63da4bd6><a href="/2019/06/javascript-has-a-unicode-problem.html#ç”Ÿäº§ç¯å¢ƒä¸­çš„bugä»¥åŠå¦‚ä½•é¿å…" data-v-63da4bd6>ç”Ÿäº§ç¯å¢ƒä¸­çš„bugä»¥åŠå¦‚ä½•é¿å…</a></li><li class="sidebar-item" data-v-63da4bd6><a href="/2019/06/javascript-has-a-unicode-problem.html#the-pile-of-poo-test" data-v-63da4bd6>The Pile of Poo Test</a></li></ul> <div class="content" data-v-63da4bd6><div class="content__default" data-v-63da4bd6><p>æœ¬æ–‡ç¿»è¯‘è‡ªhttps://mathiasbynens.be/notes/javascript-unicode</p> <hr> <p>Javascriptå¤„ç†Unicodeçš„æ–¹å¼ï¼Œè¯´å®è¯æ¯”è¾ƒè¿·ã€‚æ‰€ä»¥è¿™ç¯‡æ–‡ç« ä¸»è¦é’ˆå¯¹è¿™ä¸ªé—®é¢˜åšä¸€äº›è§£é‡Šï¼Œå¦å¤–çœ‹çœ‹es6æ˜¯æ€ä¹ˆæ”¹è¿›çš„ã€‚</p> <h2 id="unicodeåŸºç¡€"><a href="#unicodeåŸºç¡€" class="header-anchor">#</a> UnicodeåŸºç¡€</h2> <p>åœ¨æˆ‘ä»¬ç»§ç»­æ·±å…¥è®¨è®ºä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆæ‹‰å¹³ä¸€ä¸‹Unicodeçš„è®¤çŸ¥ã€‚</p> <p>ç†è§£Unicodeçš„æœ€ç®€å•é‚£çš„æ–¹å¼å°±æ˜¯å°†å®ƒæƒ³è±¡æˆä¸€ä¸ªæ•°æ®åº“ï¼Œé‡Œé¢å­˜ç€å„å¼å„æ ·çš„ç¬¦å·ä»¥åŠä»–ä»¬å¯¹åº”çš„å”¯ä¸€idï¼Œè¿™ä¸ªidè¢«å«åšcode pointï¼Œæ­¤å¤–è¿˜å­˜äº†ä»–ä»¬å”¯ä¸€çš„åå­—ã€‚è¿™æ ·ï¼Œå½“æˆ‘ä»¬è¦è¡¨è¾¾æŸä¸ªç¬¦å·çš„æ—¶å€™ï¼Œåªè¦ç»™å‡ºå¯¹åº”çš„code pointå°±å¯ä»¥äº†ã€‚æ¯”å¦‚ï¼š</p> <p>å½“æˆ‘ä»¬è¯´ï¼šU+0041ï¼Œåˆ«äººå°±çŸ¥é“æˆ‘ä»¬æƒ³è¦è¡¨è¾¾çš„æ˜¯ç¬¦å·A
å½“æˆ‘ä»¬è¯´ï¼šU+1F4A9ï¼Œåˆ«äººå°±çŸ¥é“æˆ‘ä»¬æƒ³è¦è¡¨è¾¾çš„ç¬¦å·æ˜¯ğŸ’©</p> <p>Code pointé€šå¸¸éƒ½æ˜¯ä»¥U+å¼€å¤´çš„åå…­è¿›åˆ¶æ•°å­—è¡¨ç¤ºï¼Œè‡³å°‘æœ‰4ä½ï¼Œä¸è¶³çš„ä¼šåœ¨å‰é¢è¡¥0ã€‚</p> <p>Code pointçš„èŒƒå›´æ˜¯U+0000åˆ°U+10FFFFï¼Œå¯ä»¥å®¹çº³è¶…è¿‡110ä¸‡ä¸ªå­—ç¬¦ã€‚ä¸ºäº†åˆç†ç»„ç»‡å’Œåˆ©ç”¨ï¼ŒUnicodeå°†è¿™ä¸ªèŒƒå›´åˆ’åˆ†æˆäº†17ä¸ªéƒ¨åˆ†ï¼ˆPlaneï¼‰ï¼Œæ¯ä¸ªéƒ¨åˆ†å¤§çº¦æœ‰6ä¸‡5å‰ä¸ªå­—ç¬¦ã€‚</p> <p>ç¬¬ä¸€ä¸ªéƒ¨åˆ†ï¼ˆU+0000è‡³U+FFFFï¼‰ï¼Œå«åšBasic Multilingual Planeï¼ˆBMPï¼‰ã€‚è¿™æ˜¯æœ€é‡è¦çš„ä¸€ä¸ªéƒ¨åˆ†ï¼Œå› ä¸ºå®ƒåŒ…å«äº†ç»å¤§å¤šæ•°å¸¸ç”¨çš„ç¬¦å·ã€‚å¦‚æœä½ æ˜¯åœ¨ç”¨è‹±è¯­å†™ä½œï¼Œé‚£ä½ å¾ˆæœ‰å¯èƒ½ä¸ä¼šç”¨åˆ°BMPä¹‹å¤–çš„ç¬¦å·ã€‚è·Ÿå…¶ä»–åˆ†åŒºä¸€æ ·ï¼Œè¿™ä¸ªåˆ†åŒºä¹Ÿæœ‰å¤§çº¦6æ™š5åƒä¸ªå­—ç¬¦ã€‚</p> <p>é™¤äº†BMPï¼Œå‰©ä¸‹çš„éƒ¨åˆ†ï¼ˆU+010000è‡³U+10FFFFï¼‰å¤§æ¦‚æœ‰110ä¸‡ä¸ªå­—ç¬¦ã€‚å±äºè¿™éƒ¨åˆ†çš„åˆ†åŒºè¢«ç§°ä½œå¢è¡¥åˆ†åŒºï¼ˆsupplementary planesæˆ–astral planesï¼‰ã€‚</p> <p>å¾ˆå®¹æ˜“åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ¥è‡ªå¢è¡¥åˆ†åŒºï¼Œé‚£å°±æ˜¯çœ‹å®ƒå¯¹åº”çš„åå…­è¿›åˆ¶æ•°å­—çš„ä½æ•°æ˜¯å¦è¶…è¿‡äº†4ä½ã€‚</p> <p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†Unicodeå¸¸è¯†ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹Javascriptæ˜¯å¦‚ä½•å¤„ç†å­—ç¬¦ä¸²çš„ã€‚</p> <h2 id="è½¬ä¹‰åºåˆ—"><a href="#è½¬ä¹‰åºåˆ—" class="header-anchor">#</a> è½¬ä¹‰åºåˆ—</h2> <p>ä½ åº”è¯¥è§è¿‡è¿™ç§ä¸œè¥¿ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>&gt;&gt; '\x41\x42\x43'
'ABC'

&gt;&gt; '\x61\x62\x63'
'abc'
</code></pre></div><p>è¿™ç§ä¸œè¥¿è¢«ç§°ä½œâ€œåå…­è¿›åˆ¶è½¬ä¹‰åºåˆ—â€ï¼ˆhexadecimal escape sequenceï¼‰ã€‚å®ƒæ˜¯ç”±2ä½çš„åå…­è¿›åˆ¶æ•°å­—æ¥å¯¹åº”code pointçš„ï¼Œä¾‹å¦‚\x41å¯¹åº”U+0041ï¼ˆå¤§å†™å­—æ¯Aï¼‰ã€‚å› ä¸ºåªæœ‰2ä½ï¼Œæ‰€ä»¥å®ƒåªèƒ½ç”¨æ¥å¯¹åº”U+0000åˆ°U+00FFçš„code pointã€‚</p> <p>å¦ä¸€ç§å¸¸è§çš„è½¬ç§»å­—ç¬¦å½¢å¼æ˜¯è¿™æ ·çš„ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>&gt;&gt; '\u0041\u0042\u0043'
'ABC'

&gt;&gt; 'I \u2661 JavaScript!'
'I â™¡ JavaScript!'
</code></pre></div><p>è¿™ç§ä¸œè¥¿è¢«ç§°ä½œâ€œUnicodeè½¬ä¹‰åºåˆ—â€œã€‚å®ƒæ˜¯ç”±4ä½çš„åå…­è¿›åˆ¶æ•°å­—æ¥è¡¨ç¤ºcode pointçš„ã€‚ä¾‹å¦‚\u2261è¡¨ç¤ºçš„æ˜¯U+2261ï¼ˆå¿ƒå‹ç¬¦å·ï¼‰ã€‚å› ä¸ºæ˜¯4ä½ï¼Œæ‰€ä»¥èƒ½è¡¨ç¤ºU+0000åˆ°U+FFFFèŒƒå›´çš„code pointï¼Œä¹Ÿå°±æ˜¯å®Œæ•´çš„BMPã€‚</p> <p>ç°åœ¨é—®é¢˜å‡ºç°äº†ï¼Œå¦‚æœæ˜¯éBMPå­—ç¬¦ï¼ˆå¢è¡¥åˆ†åŒºï¼‰ï¼Œæˆ‘ä»¬éœ€è¦è¶…è¿‡4ä½çš„åå…­è¿›åˆ¶æ•°å­—ï¼Œé‚£ä¹ˆè¦æ€ä¹ˆåšå‘¢ï¼Ÿ</p> <p>åœ¨ES6ä¸­ï¼Œäº‹æƒ…å°±å¾ˆå¥½åŠäº†ã€‚å› ä¸ºES6å¼•å…¥äº†ä¸€ç§æ–°çš„è½¬ç§»åºåˆ—ï¼Œå«åšâ€œUnicode code pointè½¬ä¹‰åºåˆ—â€ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>&gt;&gt; '\u{41}\u{42}\u{43}'
'ABC'

&gt;&gt; '\u{1F4A9}'
'ğŸ’©' // U+1F4A9 PILE OF POO
</code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å¤§æ‹¬å·ä¸­é—´ï¼Œä½ å¯ä»¥ä½¿ç”¨æœ€å¤š6ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼Œè¶³å¤Ÿè¡¨ç¤ºæ‰€æœ‰çš„Unicode code pointäº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥ç”¨è¿™ç§æ–¹å¼è¡¨ç¤ºä»»æ„Unicodeå­—ç¬¦ã€‚</p> <p>å¯¹äºES5ç”šè‡³æ›´è€çš„ç¯å¢ƒï¼Œä¸ºäº†å…¼å®¹æ€§ï¼Œæœ‰ä¸ªå€’éœ‰çš„è§£å†³æ–¹å¼å«åšâ€œæ›¿æ¢å¯¹å„¿â€ï¼ˆsurrogate pairsï¼‰ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>&gt;&gt; '\uD83D\uDCA9'
'ğŸ’©' // U+1F4A9 PILE OF POO
</code></pre></div><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œä¸€ä¸ªcode pointä¼šè¢«æ‹†åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œä¸å¦¨å°±å«åšsurrogate code pointï¼Œæ¢å¥è¯è¯´ï¼Œsurrogate code pointåˆåœ¨ä¸€èµ·å…±åŒè¡¨ç¤ºä¸€ä¸ªåŸå§‹code pointã€‚</p> <p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œsurrogate code pointè·ŸåŸå§‹code pointé•¿å¾—å¾ˆä¸ä¸€æ ·ã€‚è¿™ä¸¤è€…æ˜¯é€šè¿‡è¿ç®—å…¬å¼ç›¸äº’è½¬æ¢çš„ã€‚</p> <p>é€šè¿‡ä½¿ç”¨surrogate pairsï¼Œç°åœ¨æˆ‘ä»¬æ€»ç®—æ˜¯å¯ä»¥è¡¨è¾¾éBMPå­—ç¬¦äº†ã€‚ä½†é—®é¢˜æ˜¯ï¼Œç”¨ä¸€ä¸ªè½¬ç§»å­—ç¬¦è¡¨ç¤ºBMPå’Œç”¨ä¸¤ä¸ªè½¬ç§»å­—ç¬¦è¡¨ç¤ºéBMPï¼Œè¿™ä¸¤ç§æ–¹å¼åœ¨å†™æ³•ä¸Šæ²¡ä»»ä½•åŒºåˆ«ï¼Œååˆ†ä»¤äººè¿·æƒ‘ï¼Œå¹¶ä¸”å¼•å‘äº†ä¸€ç³»åˆ—é—®é¢˜ã€‚</p> <h2 id="æ•°ä¸€æ•°javascriptä¸­å­—ç¬¦ä¸²æœ‰å¤šå°‘ä¸ªunicodeç¬¦å·"><a href="#æ•°ä¸€æ•°javascriptä¸­å­—ç¬¦ä¸²æœ‰å¤šå°‘ä¸ªunicodeç¬¦å·" class="header-anchor">#</a> æ•°ä¸€æ•°Javascriptä¸­å­—ç¬¦ä¸²æœ‰å¤šå°‘ä¸ªUnicodeç¬¦å·</h2> <p>å‡è®¾ä½ è¦è®¡ç®—ä¸€ä¸ªç»™å®šå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œä½ ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ</p> <div class="language- extra-class"><pre class="language-text"><code>&gt;&gt; 'A'.length // U+0041 LATIN CAPITAL LETTER A
1

&gt;&gt; 'A' == '\u0041'
true

&gt;&gt; 'B'.length // U+0042 LATIN CAPITAL LETTER B
1

&gt;&gt; 'B' == '\u0042'
true
</code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå­—ç¬¦ä¸²çš„.lengthå±æ€§ååº”çš„æ˜¯å­—ç¬¦ä¸²ä¸­å­—æ¯çš„ä¸ªæ•°ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨è½¬ç§»åºåˆ—è¡¨ç¤ºè¿™äº›å­—ç¬¦ï¼Œé‚£ä¹ˆä¸€ä¸ªå­—ç¬¦åˆšå¥½å¯¹åº”ä¸€ä¸ªè½¬ä¹‰ç¬¦å·ã€‚ä½†æœ‰æ—¶å€™å´ä¸æ˜¯è¿™æ ·ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>&gt;&gt; 'ğ€'.length // U+1D400 MATHEMATICAL BOLD CAPITAL A
2

&gt;&gt; 'ğ€' == '\uD835\uDC00'
true

&gt;&gt; 'ğ'.length // U+1D401 MATHEMATICAL BOLD CAPITAL B
2

&gt;&gt; 'ğ' == '\uD835\uDC01'
true

&gt;&gt; 'ğŸ’©'.length // U+1F4A9 PILE OF POO
2

&gt;&gt; 'ğŸ’©' == '\uD83D\uDCA9'
true
</code></pre></div><p>è¿™æ˜¯å› ä¸ºJavascriptä½¿ç”¨surrogate pairsè¡¨ç¤ºäº†éBMPå­—ç¬¦ï¼Œå¹¶ä¸”è¿™äº›â€œåŠä¸ªsurrogate pairsâ€çœ‹ä¸Šå»å°±åƒä¸€ä¸ªç‹¬ç«‹çš„å­—ç¬¦ä¸€æ ·ã€‚è¿™ç§ç»“æœéå¸¸ä»¤äººè¿·æƒ‘ï¼Œå› ä¸ºè‚‰çœ¼çœ‹ä¸Šå»æ— æ³•åˆ†è¾¨ï¼ŒåªçŸ¥é“æ˜¯ä¸€å †Unicodeå­—ç¬¦ã€‚</p> <h2 id="æ•°ä¸€æ•°javascriptä¸­å­—ç¬¦ä¸²æœ‰å¤šå°‘ä¸ªébmpç¬¦å·"><a href="#æ•°ä¸€æ•°javascriptä¸­å­—ç¬¦ä¸²æœ‰å¤šå°‘ä¸ªébmpç¬¦å·" class="header-anchor">#</a> æ•°ä¸€æ•°Javascriptä¸­å­—ç¬¦ä¸²æœ‰å¤šå°‘ä¸ªéBMPç¬¦å·</h2> <p>å›åˆ°åˆšæ‰é‚£ä¸ªé—®é¢˜ï¼Œå¦‚ä½•ç²¾ç¡®è®¡ç®—Javascriptå­—ç¬¦ä¸²ä¸­æœ‰å¤šå°‘ä¸ªUnicodeç¬¦å·å‘¢ï¼Ÿç°åœ¨æˆ‘ä»¬çŸ¥é“äº†ï¼Œå…³é”®æ˜¯è¦æ­£ç¡®è¯†åˆ«å‡ºå…¶ä¸­å“ªäº›æ˜¯surrogate pairsï¼Œç„¶åæŠŠè¿™äº›pairså½“æˆæ˜¯ä¸€ä¸ªç¬¦å·ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> regexAstralSymbols <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\uD800-\uDBFF][\uDC00-\uDFFF]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">countSymbols</span><span class="token punctuation">(</span><span class="token parameter">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> string
    <span class="token comment">// Replace every surrogate pair with a BMP symbol.</span>
    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>regexAstralSymbols<span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span>
    <span class="token comment">// â€¦and *then* get the length.</span>
    <span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æˆ–è€…ä½ å¯ä»¥ç”¨Punycode.jsè¿™ä¸ªåº“ï¼ˆéšnodeä¸€èµ·å‘å¸ƒï¼‰ï¼Œå…ˆæŠŠJavascriptå­—ç¬¦ä¸²è½¬æ¢æˆä¸€ç»„Unicode code pointï¼Œç„¶åç»Ÿè®¡æœ‰å¤šå°‘ä¸ªcode pointï¼Œå°±åƒè¿™æ ·ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">countSymbols</span><span class="token punctuation">(</span><span class="token parameter">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> punycode<span class="token punctuation">.</span>ucs2<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å¦‚æœæ˜¯ES6ï¼Œä½ è¿˜å¯ä»¥ç”¨<code>Array.from</code>ï¼Œå®ƒä¼šä½¿ç”¨å­—ç¬¦ä¸²è¿­ä»£å™¨å¯¹å­—ç¬¦ä¸²è¿›è¡Œåˆ‡å‰²ï¼Œæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªç¬¦å·ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">countSymbols</span><span class="token punctuation">(</span><span class="token parameter">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æˆ–è€…ä½¿ç”¨spreadè¿ç®—ç¬¦</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">countSymbols</span><span class="token punctuation">(</span><span class="token parameter">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>string<span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä½¿ç”¨ä¸Šé¢ä»»æ„ä¸€ç§æ–¹æ³•ï¼Œæˆ‘ä»¬éƒ½èƒ½å¤Ÿæ­£ç¡®è®¡ç®—å‡ºå­—ç¬¦ä¸²ä¸­æœ‰å¤šå°‘ä¸ªç¬¦å·ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> <span class="token function">countSymbols</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span> <span class="token comment">// U+0041 LATIN CAPITAL LETTER A</span>
<span class="token number">1</span>

<span class="token operator">&gt;&gt;</span> <span class="token function">countSymbols</span><span class="token punctuation">(</span><span class="token string">'ğ€'</span><span class="token punctuation">)</span> <span class="token comment">// U+1D400 MATHEMATICAL BOLD CAPITAL A</span>
<span class="token number">1</span>

<span class="token operator">&gt;&gt;</span> <span class="token function">countSymbols</span><span class="token punctuation">(</span><span class="token string">'ğŸ’©'</span><span class="token punctuation">)</span> <span class="token comment">// U+1F4A9 PILE OF POO</span>
<span class="token number">1</span>
</code></pre></div><h2 id="å“ªäº›é•¿å¾—å¾ˆç›¸ä¼¼çš„ç¬¦å·"><a href="#å“ªäº›é•¿å¾—å¾ˆç›¸ä¼¼çš„ç¬¦å·" class="header-anchor">#</a> å“ªäº›é•¿å¾—å¾ˆç›¸ä¼¼çš„ç¬¦å·</h2> <p>è¿˜æœ‰æ›´å¤´ç–¼çš„äº‹æƒ…ï¼Œè®¡ç®—å­—ç¬¦ä¸²ä¸­ç¬¦å·çš„æ•°é‡å®é™…ä¸Šå¤æ‚å¤šäº†ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> <span class="token string">'maÃ±ana'</span> <span class="token operator">==</span> <span class="token string">'manÌƒana'</span>
<span class="token boolean">false</span>
</code></pre></div><p>Javascriptè¯´è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯ä¸ä¸€æ ·çš„ï¼Œä½†æ˜¯æ˜æ˜çœ‹ç€æ²¡åŒºåˆ«å‘€ï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼</p> <p><img src="https://mathiasbynens.be/_img/javascript-unicode/js-escapes-manana.png" alt=""></p> <p>ä½¿ç”¨<a href="https://mothereff.in/js-escapes#1ma%C3%B1ana%20man%CC%83ana" target="_blank" rel="noopener noreferrer">escape tool<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>è¿™ä¸ªå·¥å…·ï¼Œæˆ‘ä»¬å°±èƒ½æ‰¾åˆ°åŸå› äº†ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> <span class="token string">'ma\xF1ana'</span> <span class="token operator">==</span> <span class="token string">'man\u0303ana'</span>
<span class="token boolean">false</span>

<span class="token operator">&gt;&gt;</span> <span class="token string">'ma\xF1ana'</span><span class="token punctuation">.</span>length
<span class="token number">6</span>

<span class="token operator">&gt;&gt;</span> <span class="token string">'man\u0303ana'</span><span class="token punctuation">.</span>length
<span class="token number">7</span>
</code></pre></div><p>ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²åŒ…å«äº†ä¸€ä¸ªU+00F1 LATIN SMALL LETTER N WITH TILDEï¼Œä½†æ˜¯ç¬¬äºŒä¸ªå­—ç¬¦ä¸²åŒ…å«æœ‰ä¸¤ä¸ªç‹¬ç«‹çš„code pointï¼ˆU+006E LATIN SMALL LETTER Nå’ŒU+0303 COMBINING TILDEï¼‰ç»„åˆåœ¨ä¸€èµ·å½¢æˆä¸€æ ·çš„å›¾æ¡ˆã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ˜æ˜ä»–ä»¬çœ‹ä¸Šå»ä¸€æ ·ï¼Œ<code>.length</code>å´ä¸ä¸€æ ·ã€‚</p> <p>ä½†æ˜¯ï¼Œå¦‚æœä½ æŒ‰ç…§äººç±»çš„æ­£å¸¸æ€ç»´å»æ•°åˆ°åº•æœ‰å¤šå°‘ç¬¦å·ï¼Œä¸Šé¢ä¸¤ä¸ªå­—ç¬¦ä¸²çš„ç»“æœéƒ½æ˜¯6ï¼Œè¿™åˆæ˜¯ä»€ä¹ˆé¬¼å‘¢ï¼Ÿ</p> <p>åœ¨ES6ä¸­ï¼Œç­”æ¡ˆæ˜¯å¾ˆç®€å•çš„ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">countSymbolsPedantically</span><span class="token punctuation">(</span><span class="token parameter">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Unicode Normalization, NFC form, to account for lookalikes:</span>
  <span class="token keyword">var</span> normalized <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token string">'NFC'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Account for astral symbols / surrogates, just like we did before:</span>
  <span class="token keyword">return</span> punycode<span class="token punctuation">.</span>ucs2<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>normalized<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™ä¸ª<code>normalize</code>æ–¹æ³•çš„æ•ˆæœæ˜¯ä½¿æ‰€æœ‰é•¿å¾—ç±»ä¼¼çš„Unicodeéƒ½ç»Ÿä¸€æˆä¸€ä¸ªï¼ˆUnicode normalizationï¼‰ã€‚å¦‚æœä¸€ä¸ªcode pointå¯¹åº”çš„ç¬¦å·è·Ÿä¸¤ä¸ªcode pointså¯¹åº”çš„ç¬¦å·ç»„åˆåœ¨ä¸€èµ·é•¿å¾—å·®ä¸å¤šï¼Œé‚£ä¹ˆä»–ä»¬å°±ä¼šè¢«ç»Ÿä¸€æˆä¸€ä¸ªcode pointã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> <span class="token function">countSymbolsPedantically</span><span class="token punctuation">(</span><span class="token string">'maÃ±ana'</span><span class="token punctuation">)</span> <span class="token comment">// U+00F1</span>
<span class="token number">6</span>
<span class="token operator">&gt;&gt;</span> <span class="token function">countSymbolsPedantically</span><span class="token punctuation">(</span><span class="token string">'manÌƒana'</span><span class="token punctuation">)</span> <span class="token comment">// U+006E + U+0303</span>
<span class="token number">6</span>
</code></pre></div><p>å¯¹äºES5å’Œæ›´è€çš„ç¯å¢ƒï¼Œå¯ä»¥ä½¿ç”¨polyfillè¾¾åˆ°åŒæ ·çš„åŠŸèƒ½ã€‚</p> <h2 id="å¥½å¤šä¸ªç»„åˆæ ‡è®°"><a href="#å¥½å¤šä¸ªç»„åˆæ ‡è®°" class="header-anchor">#</a> å¥½å¤šä¸ªç»„åˆæ ‡è®°</h2> <p>ä¸Šé¢çš„æ–¹æ³•ä»ç„¶ä¸å¤Ÿå®Œç¾ï¼Œå› ä¸ºå¯èƒ½åŒæ—¶æœ‰å¾ˆå¤šä¸ªå­—ç¬¦ç»„åˆåœ¨ä¸€èµ·ï¼Œè€Œä¸”æ²¡æœ‰å¯¹åº”çš„normalizeå½¢å¼ï¼Œè¿™ç§æ—¶å€™normalizeæ–¹æ³•å°±æ²¡ç”¨äº†ã€‚æ¯”å¦‚ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> <span class="token string">'q\u0307\u0323'</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token string">'NFC'</span><span class="token punctuation">)</span> <span class="token comment">// `qÌ‡Ì£`</span>
<span class="token string">'q\u0307\u0323'</span>

<span class="token operator">&gt;&gt;</span> <span class="token function">countSymbolsPedantically</span><span class="token punctuation">(</span><span class="token string">'q\u0307\u0323'</span><span class="token punctuation">)</span>
<span class="token number">3</span> <span class="token comment">// not 1</span>

<span class="token operator">&gt;&gt;</span> <span class="token function">countSymbolsPedantically</span><span class="token punctuation">(</span><span class="token string">'ZÍ‘Í«ÍƒÍªÌ‚Í«Ì½ÍÌ´Ì™Ì¤ÌÍ‰ÍšÌ¯ÌÌ ÍAÍ«Í—Ì´Í¢ÌµÌœÌ°Í”LÍ¨Í§Í©Í˜Ì GÌ‘Í—ÌÌ…Í›ÍÌ´Ì»ÍˆÍÍ”Ì¹OÍ‚ÌŒÌŒÍ˜Ì¨ÌµÌ¹Ì»ÌÌ³!Ì¿Ì‹Í¥Í¥Ì‚Í£ÌÌÌÍÍœÍ–Ì¬Ì°Ì™Ì—'</span><span class="token punctuation">)</span>
<span class="token number">74</span> <span class="token comment">// not 6</span>
</code></pre></div><p>å½“ç„¶ä½ å¯ä»¥ç”¨ä¸€äº›é¸¡è´¼çš„æ–¹æ³•ï¼Œæ¯”å¦‚ç”¨æ­£åˆ™è¡¨è¾¾å¼å‰”é™¤æ‰ç»„åˆå­—ç¬¦ç„¶åå¾—åˆ°æ­£ç¡®çš„ç»“æœï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Note: replace the following regular expression with its transpiled equivalent</span>
<span class="token comment">// to make it work in old environments. https://mths.be/bwm</span>
<span class="token keyword">var</span> regexSymbolWithCombiningMarks <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(\P{Mark})(\p{Mark}+)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">gu</span></span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">countSymbolsIgnoringCombiningMarks</span><span class="token punctuation">(</span><span class="token parameter">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Remove any combining marks, leaving only the symbols they belong to:</span>
  <span class="token keyword">var</span> stripped <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>regexSymbolWithCombiningMarks<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$0<span class="token punctuation">,</span> symbol<span class="token punctuation">,</span> combiningMarks</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> symbol<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Account for astral symbols / surrogates, just like we did before:</span>
  <span class="token keyword">return</span> punycode<span class="token punctuation">.</span>ucs2<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>stripped<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä¸Šé¢è¿™ä¸ªæ–¹æ³•ä¼šå…ˆå‰”é™¤é‚£äº›ç»„åˆç¬¦å·ï¼Œç„¶åå†ç»Ÿè®¡ç¬¦å·ä¸ªæ•°ï¼Œè¿™ä¸ªæ–¹æ³•ç”šè‡³å¯¹ES3éƒ½å¯ä»¥ä½¿ç”¨ï¼Œå¹¶ä¸”æä¾›çš„ç»“æœç›¸å½“ç²¾ç¡®ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> <span class="token function">countSymbolsIgnoringCombiningMarks</span><span class="token punctuation">(</span><span class="token string">'q\u0307\u0323'</span><span class="token punctuation">)</span>
<span class="token number">1</span>
<span class="token operator">&gt;&gt;</span> <span class="token function">countSymbolsIgnoringCombiningMarks</span><span class="token punctuation">(</span><span class="token string">'ZÍ‘Í«ÍƒÍªÌ‚Í«Ì½ÍÌ´Ì™Ì¤ÌÍ‰ÍšÌ¯ÌÌ ÍAÍ«Í—Ì´Í¢ÌµÌœÌ°Í”LÍ¨Í§Í©Í˜Ì GÌ‘Í—ÌÌ…Í›ÍÌ´Ì»ÍˆÍÍ”Ì¹OÍ‚ÌŒÌŒÍ˜Ì¨ÌµÌ¹Ì»ÌÌ³!Ì¿Ì‹Í¥Í¥Ì‚Í£ÌÌÌÍÍœÍ–Ì¬Ì°Ì™Ì—'</span><span class="token punctuation">)</span>
<span class="token number">6</span>
</code></pre></div><h2 id="å…¶ä»–ç±»å‹çš„ç¬¦å·"><a href="#å…¶ä»–ç±»å‹çš„ç¬¦å·" class="header-anchor">#</a> å…¶ä»–ç±»å‹çš„ç¬¦å·</h2> <p>ä¸Šé¢ä»‹ç»çš„æ–¹æ³•ä»ç„¶è¿‡äºç®€å•äº†ï¼Œå› ä¸ºå®ƒå¯¹äºä¸‹é¢è¿™ç§ä¸æ˜¯ç»„åˆç¬¦å·ä½†åˆæŒ¤åœ¨ä¸€èµ·çš„ç¬¦å·ä½¿æ— èƒ½ä¸ºåŠ›ï¼Œæ¯”å¦‚à®¨à®¿ (à®¨ + à®¿)ï¼Œæˆ–è€…á„á…¡á†¨ (á„ + á…¡ + á†¨)ï¼Œæˆ–è€…ç‰¹æ®Šemojiåºåˆ—æ¯”å¦‚ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ (ğŸ‘¨ + U+200D ZERO WIDTH JOINER + ğŸ‘© + U+200D ZERO WIDTH JOINER + ğŸ‘§ + U+200D ZERO WIDTH JOINER + ğŸ‘¦)ï¼Œæˆ–è€…å…¶ä»–çš„æƒ…å†µã€‚ã€‚</p> <p>Unicodeè§„èŒƒç¬¬29å·é™„å½•â€œUnicode Text Segmentationâ€æè¿°äº†ä¸€ä¸ªåˆ¤å®šç°‡å‹ç¬¦å·è¾¹ç•Œçš„ç®—æ³•ã€‚æ‰€ä»¥ï¼Œ100%ç²¾ç¡®çš„è§£å†³åŠæ³•æ˜¯ç”¨Javascriptå»å®ç°é‚£ä¸ªç®—æ³•ï¼Œç„¶åå†ç»Ÿè®¡åˆ°åº•æœ‰å¤šå°‘ä¸ªè‚‰çœ¼å¯è§çš„å­—ç¬¦ã€‚ESæœ‰ä¸€ä¸ªææ¡ˆæ˜¯å¼•å…¥ä¸€ä¸ªå«<code>Intl.Segmenter</code>çš„æ–¹æ³•ï¼Œæ¥å†³å®šæ–‡æœ¬çš„åˆ†éš”ç¬¦çš„ï¼Œå¯ä»¥è¾…åŠ©è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p> <h2 id="åœ¨javascriptä¸­å°†å­—ç¬¦ä¸²åè¿‡æ¥"><a href="#åœ¨javascriptä¸­å°†å­—ç¬¦ä¸²åè¿‡æ¥" class="header-anchor">#</a> åœ¨Javascriptä¸­å°†å­—ç¬¦ä¸²åè¿‡æ¥</h2> <p>ä¸ä¸Šé¢çš„æ•°å­—ç¬¦ç›¸æ¯”ï¼Œè¿˜æœ‰ä¸€ä¸ªç±»ä¼¼çš„é—®é¢˜ï¼šåè½¬Javascriptçš„å­—ç¬¦ä¸²ã€‚è¿™æœ‰ä»€ä¹ˆéš¾çš„ï¼Ÿæœ€ç®€å•çš„æ–¹æ³•æ˜¯ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// naive solution</span>
<span class="token keyword">function</span> <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token parameter">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> string<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹çœ‹ç€éƒ½æ²¡é—®é¢˜</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span>
<span class="token string">'cba'</span>

<span class="token operator">&gt;&gt;</span> <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token string">'maÃ±ana'</span><span class="token punctuation">)</span> <span class="token comment">// U+00F1</span>
<span class="token string">'anaÃ±am'</span>
</code></pre></div><p>ä½†æ˜¯ï¼Œå¦‚æœå­—ç¬¦ä¸²åŒ…å«ç»„åˆæ ‡è®°ï¼Œæˆ–è€…éBMPç¬¦å·ï¼Œå°±ä¸ç®¡ç”¨äº†ã€‚æ¯”å¦‚ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token string">'maÃ±ana'</span><span class="token punctuation">)</span> <span class="token comment">// U+006E + U+0303</span>
<span class="token string">'anaÌƒnam'</span> <span class="token comment">// note: the `~` is now applied to the `a` instead of the `n`</span>

<span class="token operator">&gt;&gt;</span> <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token string">'ğŸ’©'</span><span class="token punctuation">)</span> <span class="token comment">// U+1F4A9</span>
<span class="token string">'  '</span> <span class="token comment">// `'\uDCA9\uD83D'`, the surrogate pair for `ğŸ’©` in the wrong order</span>
</code></pre></div><p>ä¸ºäº†èƒ½æ­£ç¡®åè½¬éBMPç¬¦å·ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥ç”¨ES6å¼•å…¥çš„å­—ç¬¦ä¸²è¿­ä»£å™¨æ¥åšã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// slightly better solution that relies on ES6 StringIterator and `Array.from`</span>
<span class="token keyword">function</span> <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token parameter">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä¸è¿‡è¿™ä¸ªæ–¹æ³•å¯¹äºç»„åˆæ ‡è®°è¿˜æ˜¯ä¸è¡Œã€‚</p> <p>å¹¸è¿çš„æ˜¯ï¼Œè¿™ä¸ªè¿˜ç®—å¥½è§£å†³ï¼Œå°±æ˜¯åœ¨åè½¬ä¹‹å‰æŠŠæ‰€æœ‰ç»„åˆæ ‡è®°å¤šåè½¬ä¸€æ¬¡å°±å¥½äº†ã€‚æœ‰ä¸ªåº“å¯ä»¥åšè¿™ä¸ªäº‹æƒ…ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// using Esrever (https://mths.be/esrever)</span>

<span class="token operator">&gt;&gt;</span> esrever<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token string">'maÃ±ana'</span><span class="token punctuation">)</span> <span class="token comment">// U+006E + U+0303</span>
<span class="token string">'anaÃ±am'</span>

<span class="token operator">&gt;&gt;</span> esrever<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token string">'ğŸ’©'</span><span class="token punctuation">)</span> <span class="token comment">// U+1F4A9</span>
<span class="token string">'ğŸ’©'</span> <span class="token comment">// U+1F4A9</span>
</code></pre></div><h2 id="å­—ç¬¦ä¸²æ–¹æ³•ä¸­çš„unicodeé—®é¢˜"><a href="#å­—ç¬¦ä¸²æ–¹æ³•ä¸­çš„unicodeé—®é¢˜" class="header-anchor">#</a> å­—ç¬¦ä¸²æ–¹æ³•ä¸­çš„Unicodeé—®é¢˜</h2> <p>å­—ç¬¦ä¸²çš„æŸäº›æ–¹æ³•ä¹Ÿä¼šæ”¶åˆ°å½±å“</p> <h3 id="å°†code-pointè½¬æ¢æˆç¬¦å·"><a href="#å°†code-pointè½¬æ¢æˆç¬¦å·" class="header-anchor">#</a> å°†code pointè½¬æ¢æˆç¬¦å·</h3> <p><code>String.fromCharCode</code>å¯ä»¥è®©ä½ ä»Unicode code pointç›´æ¥å¾—åˆ°å¯¹åº”çš„ç¬¦å·ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•åªå¯¹BMPç¬¦å·æœ‰æ•ˆã€‚å¦‚æœä½ ä½¿ç”¨äº†éBMPç¬¦å·çš„code pointä½ ä¼šå¾—åˆ°é”™è¯¯çš„ç»“æœã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">0x0041</span><span class="token punctuation">)</span> <span class="token comment">// U+0041</span>
<span class="token string">'A'</span> <span class="token comment">// U+0041</span>

<span class="token operator">&gt;&gt;</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">0x1F4A9</span><span class="token punctuation">)</span> <span class="token comment">// U+1F4A9</span>
<span class="token string">'ï’©'</span> <span class="token comment">// U+F4A9, not U+1F4A9</span>
</code></pre></div><p>å”¯ä¸€çš„åŠæ³•æ˜¯ä½¿ç”¨surrogate pairsï¼Œä½†æ˜¯ä½ å¾—å…ˆå­¦ä¼šå¦‚ä½•ä»code pointsè®¡ç®—å¾—åˆ°surrogate code point</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">0xD83D</span><span class="token punctuation">,</span> <span class="token number">0xDCA9</span><span class="token punctuation">)</span>
<span class="token string">'ğŸ’©'</span> <span class="token comment">// U+1F4A9</span>
</code></pre></div><p>å¦‚æœä½ ä¸æƒ³è‡ªå·±è®¡ç®—surrogate code pointï¼Œä½ å¯ä»¥ç”¨punycode.jsçš„<code>encode</code>æ–¹æ³•</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> punycode<span class="token punctuation">.</span>ucs2<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token number">0x1F4A9</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token string">'ğŸ’©'</span> <span class="token comment">// U+1F4A9</span>
</code></pre></div><p>å¹¸è¿çš„æ˜¯ï¼ŒES6å¼•å…¥äº†ä¸€ä¸ª<code>String.fromCodePoint(codepoint)</code>çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•èƒ½å¤Ÿæ­£ç¡®å¤„ç†æ‰€æœ‰Unicodeå­—ç¬¦ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> String<span class="token punctuation">.</span><span class="token function">fromCodePoint</span><span class="token punctuation">(</span><span class="token number">0x1F4A9</span><span class="token punctuation">)</span>
<span class="token string">'ğŸ’©'</span> <span class="token comment">// U+1F4A9</span>
</code></pre></div><p>å¦‚æœæ˜¯ES5æˆ–è€…æ›´è€çš„ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨String.fromCodePointçš„polyfillã€‚</p> <h3 id="ä»å­—ç¬¦ä¸²ä¸­æ‰£å–å­—ç¬¦"><a href="#ä»å­—ç¬¦ä¸²ä¸­æ‰£å–å­—ç¬¦" class="header-anchor">#</a> ä»å­—ç¬¦ä¸²ä¸­æ‰£å–å­—ç¬¦</h3> <p>å¦‚æœä½ ä½¿ç”¨<code>String.prototype.charAt(position)</code>æ¥ä»ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æ‰£å–ä¸€ä¸ªéBMPå­—ç¬¦ï¼Œé‚£ä¹ˆä½ å¾—åˆ°çš„æ˜¯åŠä¸ªsurrogate pairã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> <span class="token string">'ğŸ’©'</span><span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// U+1F4A9</span>
<span class="token string">'\uD83D'</span> <span class="token comment">// U+D83D, i.e. the first surrogate half for U+1F4A9</span>
</code></pre></div><p>ES7æœ‰ä¸€ä¸ªææ¡ˆæ˜¯å¸Œæœ›å¼•å…¥ä¸€ä¸ªæ–°æ–¹æ³•<code>String.prototype.at(position)</code>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> <span class="token string">'ğŸ’©'</span><span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// U+1F4A9</span>
<span class="token string">'ğŸ’©'</span> <span class="token comment">// U+1F4A9</span>
</code></pre></div><p>åŒæ ·çš„ï¼Œä¹Ÿæœ‰å¯¹åº”çš„polyfillå¯ç”¨ã€‚</p> <h3 id="ä»å­—ç¬¦ä¸²ä¸­æ‰£å–code-point"><a href="#ä»å­—ç¬¦ä¸²ä¸­æ‰£å–code-point" class="header-anchor">#</a> ä»å­—ç¬¦ä¸²ä¸­æ‰£å–code point</h3> <p>åŒæ ·çš„ï¼Œå¦‚æœä½ ç”¨<code>String.prototype.charCodeAt(position)</code>æƒ³æ‰£å–æŒ‡å®šä½ç½®çš„code pointï¼Œå¯¹äºéBMPç¬¦å·ï¼Œä½ åªä¼šå¾—åˆ°åŠä¸ªsurrogate pairã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> <span class="token string">'ğŸ’©'</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token number">0xD83D</span>
</code></pre></div><p>ES6æä¾›äº†ä¸€ä¸ªæ–¹æ³•<code>String.prototype.codePointAt(position)</code>å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> <span class="token string">'ğŸ’©'</span><span class="token punctuation">.</span><span class="token function">codePointAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token number">0x1F4A9</span>
</code></pre></div><p>åŒæ ·çš„ï¼Œä¹Ÿæœ‰polyfillå¯ä»¥ç”¨ã€‚</p> <h3 id="éå†å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰ç¬¦å·"><a href="#éå†å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰ç¬¦å·" class="header-anchor">#</a> éå†å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰ç¬¦å·</h3> <p>å‡è®¾ä½ è¦éå†å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰ç¬¦å·ï¼Œåœ¨ES5ä¸­ï¼Œä½ éœ€è¦å†™ä¸€å¤§å †ä»£ç æ‰èƒ½å®ç°æ­£ç¡®çš„é€»è¾‘ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getSymbols</span><span class="token punctuation">(</span><span class="token parameter">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> length <span class="token operator">=</span> string<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token keyword">var</span> output <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> <span class="token operator">++</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> charCode <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>charCode <span class="token operator">&gt;=</span> <span class="token number">0xD800</span> <span class="token operator">&amp;&amp;</span> charCode <span class="token operator">&lt;=</span> <span class="token number">0xDBFF</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      charCode <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>charCode <span class="token operator">&gt;=</span> <span class="token number">0xDC00</span> <span class="token operator">&amp;&amp;</span> charCode <span class="token operator">&lt;=</span> <span class="token number">0xDFFF</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        output<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">++</span>index<span class="token punctuation">;</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    output<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> output<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> symbols <span class="token operator">=</span> <span class="token function">getSymbols</span><span class="token punctuation">(</span><span class="token string">'ğŸ’©'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
symbols<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">symbol</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">assert</span><span class="token punctuation">(</span>symbol <span class="token operator">==</span> <span class="token string">'ğŸ’©'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>æˆ–è€…ä½ å¯ä»¥ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ¯”å¦‚<code>var regexCodePoint = /[^\uD800-\uDFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDFFF]/g;</code>æ¥åšç±»ä¼¼çš„äº‹æƒ…ã€‚</p> <p>åœ¨ES6ä¸­ï¼Œç›´æ¥ç”¨for ofè¿­ä»£å™¨å°±å¯ä»¥äº†</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> symbol <span class="token keyword">of</span> <span class="token string">'ğŸ’©'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">assert</span><span class="token punctuation">(</span>symbol <span class="token operator">==</span> <span class="token string">'ğŸ’©'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä¸è¿‡for ofæ˜¯æ²¡æœ‰polyfillçš„ï¼Œå› ä¸ºè¿™æ˜¯ä¸ªè¯­æ³•å±‚é¢çš„æ–°åŠŸèƒ½ã€‚</p> <h3 id="å…¶ä»–é—®é¢˜"><a href="#å…¶ä»–é—®é¢˜" class="header-anchor">#</a> å…¶ä»–é—®é¢˜</h3> <p>å…¶å®å‡ ä¹æ‰€æœ‰Stringçš„æ–¹æ³•éƒ½ä¼šå—åˆ°å½±å“ï¼Œæ¯”å¦‚ï¼ˆString.prototype.substringï¼ŒString.prototype.sliceç­‰ç­‰ï¼‰ï¼Œæ‰€ä»¥ä½¿ç”¨ä»–ä»¬çš„æ—¶å€™è¦å°å¿ƒã€‚</p> <h2 id="unicodeå¯¹æ­£åˆ™è¡¨è¾¾å¼çš„å½±å“"><a href="#unicodeå¯¹æ­£åˆ™è¡¨è¾¾å¼çš„å½±å“" class="header-anchor">#</a> Unicodeå¯¹æ­£åˆ™è¡¨è¾¾å¼çš„å½±å“</h2> <h3 id="åŒ¹é…code-pointå’Œunicodeç¬¦å·"><a href="#åŒ¹é…code-pointå’Œunicodeç¬¦å·" class="header-anchor">#</a> åŒ¹é…code pointå’ŒUnicodeç¬¦å·</h3> <p>åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œ<code>.</code>ä»£è¡¨ä¸€ä¸ªå•ä¸ªçš„ç¬¦å·ï¼Œä½†æ˜¯å› ä¸ºjavascriptæ˜¯ç”¨surrogate pairsæ¥è¡¨ç¤ºéBMPçš„ï¼Œè€Œæ­£åˆ™è¡¨è¾¾å¼ä¼šè®¤ä¸ºè¿™æ˜¯ä¸¤ä¸ªå­—ç¬¦ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">foo.bar</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'fooğŸ’©bar'</span><span class="token punctuation">)</span>
<span class="token boolean">false</span>
</code></pre></div><p>è®©æˆ‘ä»¬åœä¸‹æ¥ä»”ç»†æ€è€ƒä¸€ä¸‹ï¼Œæ€ä¹ˆæ ·è®©æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…éBMPç¬¦å·å‘¢ï¼Ÿæ˜¾ç„¶<code>.</code>æ˜¯ä¸è¡Œçš„ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^.$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'ğŸ’©'</span><span class="token punctuation">)</span>
<span class="token boolean">false</span>
</code></pre></div><p>ä¸€ç§åŠæ³•æ˜¯ç›´æ¥æ‰‹å†™å‡ºcode pointsç©ºé—´ï¼Œè™½ç„¶çœ‹ä¸Šå»ä¸æ˜¯é‚£ä¹ˆç›´è§‚ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\0-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'ğŸ’©'</span><span class="token punctuation">)</span> <span class="token comment">// wtf</span>
<span class="token boolean">true</span>
</code></pre></div><p>å½“ç„¶é€šå¸¸ä½ ä¸éœ€è¦æ‰‹å†™è¿™äº›ä¸œè¥¿ï¼Œå› ä¸ºä¼šæœ‰ä¸€äº›ç°æˆçš„ç¬¬ä¸‰æ–¹åº“å¸®ä½ åšè¿™ä¸ªäº‹æƒ…ï¼Œæ¯”å¦‚regenerateï¼Œå®ƒèƒ½å¤Ÿæ ¹æ®code pointæˆ–ç¬¦å·ç”Ÿæˆå¯¹åº”çš„æ­£åˆ™ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> <span class="token function">regenerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addRange</span><span class="token punctuation">(</span><span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x10FFFF</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'[\0-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]'</span>
</code></pre></div><p>ç”Ÿæˆçš„æ­£åˆ™ä»å·¦åˆ°å³ä¾æ¬¡åŒ¹é…äº†BMPç¬¦å·ï¼Œsurroage pairsï¼Œlong surrogatesã€‚è‡³äºlong surrogateæ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œè¿™é‡Œå°±ä¸ä½œå±•å¼€äº†ã€‚</p> <p>ES6å¼•å…¥äº†ä¸€ä¸ªuæ ‡è®°ï¼Œç”¨æ¥è§£å†³ä¸Šé¢æ‰€è¿°çš„æ­£åˆ™åŒ¹é…çš„<code>.</code>é—®é¢˜ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">foo.bar</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'fooğŸ’©bar'</span><span class="token punctuation">)</span>
<span class="token boolean">false</span>

<span class="token operator">&gt;&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">foo.bar</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'fooğŸ’©bar'</span><span class="token punctuation">)</span>
<span class="token boolean">true</span>
</code></pre></div><h3 id="ébmpç¬¦å·çš„åˆ†ç±»"><a href="#ébmpç¬¦å·çš„åˆ†ç±»" class="header-anchor">#</a> éBMPç¬¦å·çš„åˆ†ç±»</h3> <p>æ¯”å¦‚åƒ<code>/[a-c]/</code>è¿™æ ·çš„æ­£åˆ™ï¼Œæˆ‘ä»¬çŸ¥é“æ˜¯ä»U+0061 LATIN SMALL LETTER A åˆ° U+0063 LATIN SMALL LETTER Cã€‚å¦‚æœæ˜¯<code>/[ğŸ’©-ğŸ’«]/</code>ï¼Œçœ‹ä¸Šå»å°±æ˜¯ä»U+1F4A9 PILE OF POO åˆ° U+1F4AB DIZZY SYMBOLï¼Œä½†å®é™…å¹¶ä¸æ˜¯è¿™æ ·ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>&gt;&gt; /[ğŸ’©-ğŸ’«]/
SyntaxError: Invalid regular expression: Range out of order in character class
</code></pre></div><p>è¿™æ˜¯å› ä¸ºä¸Šé¢çš„æ­£åˆ™ç­‰ä»·äºä¸‹é¢è¿™æ ·</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\uD83D\uDCA9-\uD83D\uDCAB]</span><span class="token regex-delimiter">/</span></span>
<span class="token literal-property property">SyntaxError</span><span class="token operator">:</span> Invalid regular expression<span class="token operator">:</span> Range out <span class="token keyword">of</span> order <span class="token keyword">in</span> character <span class="token keyword">class</span>
</code></pre></div><p>åˆæ˜¯surrogate pairsï¼Œæ‰€ä»¥å®é™…ä¸Šè¿™ä¸ªæ­£åˆ™åŒ¹é…çš„æ˜¯ä¸‰æ®µï¼Œè€Œä¸­é—´é‚£ä¸€æ®µ\uDCA9-\uD83Dæ˜¯éæ³•çš„ï¼Œå› ä¸ºèµ·å§‹ç¼–ç å¤§äºäº†ç»“æŸç¼–ç ã€‚</p> <p>ES6å†ä¸€æ¬¡æ‹¯æ•‘äº†æˆ‘ä»¬ï¼Œé€šè¿‡uæ ‡è®°å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\uD83D\uDCA9-\uD83D\uDCAB]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'\uD83D\uDCA9'</span><span class="token punctuation">)</span> <span class="token comment">// match U+1F4A9</span>
<span class="token boolean">true</span>

<span class="token operator">&gt;&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\u{1F4A9}-\u{1F4AB}]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'\u{1F4A9}'</span><span class="token punctuation">)</span> <span class="token comment">// match U+1F4A9</span>
<span class="token boolean">true</span>

<span class="token operator">&gt;&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[ğŸ’©-ğŸ’«]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'ğŸ’©'</span><span class="token punctuation">)</span> <span class="token comment">// match U+1F4A9</span>
<span class="token boolean">true</span>

<span class="token operator">&gt;&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\uD83D\uDCA9-\uD83D\uDCAB]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'\uD83D\uDCAA'</span><span class="token punctuation">)</span> <span class="token comment">// match U+1F4AA</span>
<span class="token boolean">true</span>

<span class="token operator">&gt;&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\u{1F4A9}-\u{1F4AB}]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'\u{1F4AA}'</span><span class="token punctuation">)</span> <span class="token comment">// match U+1F4AA</span>
<span class="token boolean">true</span>

<span class="token operator">&gt;&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[ğŸ’©-ğŸ’«]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'ğŸ’ª'</span><span class="token punctuation">)</span> <span class="token comment">// match U+1F4AA</span>
<span class="token boolean">true</span>

<span class="token operator">&gt;&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\uD83D\uDCA9-\uD83D\uDCAB]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'\uD83D\uDCAB'</span><span class="token punctuation">)</span> <span class="token comment">// match U+1F4AB</span>
<span class="token boolean">true</span>

<span class="token operator">&gt;&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\u{1F4A9}-\u{1F4AB}]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'\u{1F4AB}'</span><span class="token punctuation">)</span> <span class="token comment">// match U+1F4AB</span>
<span class="token boolean">true</span>

<span class="token operator">&gt;&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[ğŸ’©-ğŸ’«]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'ğŸ’«'</span><span class="token punctuation">)</span> <span class="token comment">// match U+1F4AB</span>
<span class="token boolean">true</span>
</code></pre></div><p>ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•æ— æ³•å…¼å®¹ES5å’Œæ›´è€çš„ç¯å¢ƒï¼Œå¦‚æœä½ çœŸçš„æœ‰éœ€è¦ï¼Œå»ºè®®ä½¿ç”¨regenerateè¿™ä¸ªå·¥å…·åº“ç”Ÿæˆæ­£ç¡®çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;&gt;</span> <span class="token function">regenerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addRange</span><span class="token punctuation">(</span><span class="token string">'ğŸ’©'</span><span class="token punctuation">,</span> <span class="token string">'ğŸ’«'</span><span class="token punctuation">)</span>
<span class="token string">'\uD83D[\uDCA9-\uDCAB]'</span>

<span class="token operator">&gt;&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\uD83D[\uDCA9-\uDCAB]$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'ğŸ’©'</span><span class="token punctuation">)</span> <span class="token comment">// match U+1F4A9</span>
<span class="token boolean">true</span>

<span class="token operator">&gt;&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\uD83D[\uDCA9-\uDCAB]$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'ğŸ’ª'</span><span class="token punctuation">)</span> <span class="token comment">// match U+1F4AA</span>
<span class="token boolean">true</span>

<span class="token operator">&gt;&gt;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\uD83D[\uDCA9-\uDCAB]$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'ğŸ’«'</span><span class="token punctuation">)</span> <span class="token comment">// match U+1F4AB</span>
<span class="token boolean">true</span>
</code></pre></div><h2 id="ç”Ÿäº§ç¯å¢ƒä¸­çš„bugä»¥åŠå¦‚ä½•é¿å…"><a href="#ç”Ÿäº§ç¯å¢ƒä¸­çš„bugä»¥åŠå¦‚ä½•é¿å…" class="header-anchor">#</a> ç”Ÿäº§ç¯å¢ƒä¸­çš„bugä»¥åŠå¦‚ä½•é¿å…</h2> <p>ä¸¾ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼Œtwitterçš„æ¯ä¸€ä¸ªtweetåªå…è®¸140ä¸ªå­—ç¬¦ï¼Œè€Œåç«¯å¯ä¸ç®¡è¿™æ˜¯ä»€ä¹ˆå­—ç¬¦ï¼ŒBMPè¿˜æ˜¯éBMPã€‚ä½†æ˜¯å› ä¸ºJavascriptåœ¨å‰ç«¯æ˜¯ä»…ä»…é€šè¿‡<code>length</code>æ–¹æ³•åˆ¤æ–­é•¿åº¦ï¼Œæ‰€ä»¥å¦‚æœä½ è¾“å…¥çš„éƒ½æ˜¯éBMPå­—ç¬¦ï¼Œé‚£æœ€å¤šåªèƒ½æ‰“70ä¸ªã€‚ï¼ˆè¿™ä¸ªbugç°åœ¨å·²ç»è¢«ä¿®å¤äº†ï¼‰</p> <p>è®¸å¤šjavascriptçš„åº“éƒ½æ²¡èƒ½æ­£ç¡®å¤„ç†éBMPå­—ç¬¦ã€‚æ¯”å¦‚countable.js,underscore.jsç­‰ç­‰ã€‚æœ‰æ—¶å€™htmlä¸­åŒ…å«ä¸€äº›ç‰¹æ®Šçš„æ•°å­—ä¹Ÿå¯èƒ½å¯¼è‡´htmlè§£ç å¤±è´¥ï¼Œæ¯”å¦‚&amp;#X1F4A9ã€‚è¿™é‡Œæ¨èheè¿™ä¸ªåº“åšhtmlçš„ç¼–è§£ç ã€‚</p> <p>ä»¥ä¸Šè¿™äº›éƒ½æ˜¯æ¯”è¾ƒå®¹æ˜“äº§ç”Ÿå’Œä¿®å¤çš„é”™è¯¯ï¼Œæ¯•ç«ŸJavascriptå¤„ç†Unicodeæ˜¯å¾ˆéº»çƒ¦çš„ã€‚é‚£ä¹ˆé™¤äº†ä¿®å¤çš„åŠæ³•ï¼Œæ€ä¹ˆå‘ç°è¿™äº›é”™è¯¯å‘¢ï¼Ÿ</p> <h2 id="the-pile-of-poo-test"><a href="#the-pile-of-poo-test" class="header-anchor">#</a> The Pile of Poo Test</h2> <p>æ— è®ºä½•æ—¶å½“ä½ ç¼–å†™éœ€è¦å¤„ç†å­—ç¬¦ä¸²æˆ–æ­£åˆ™è¡¨è¾¾å¼çš„ä»£ç æ—¶ï¼Œè®°å¾—åœ¨UTçš„å­—ç¬¦ä¸²é‡Œæ·»åŠ ä¸€ä¸ªç¿”ï¼ˆğŸ’©ï¼‰ï¼Œç„¶åçœ‹çœ‹æ˜¯å¦æ­£å¸¸ã€‚è¿™ä¸ªæ–¹æ³•å¾ˆæ–¹ä¾¿ï¼Œå¾ˆç®¡ç”¨ï¼Œä¹Ÿå¾ˆæœ‰è¶£ï¼Œèƒ½å¸®åŠ©ä½ æ£€æŸ¥ä½ çš„ä»£ç æ˜¯å¦æ­£ç¡®å¤„ç†äº†éBMPå­—ç¬¦ã€‚å¦‚æœä½ å‘ç°äº†é”™è¯¯ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ä¸Šé¢ä»‹ç»çš„æ–¹æ³•ä¿®å¤äº†ã€‚</p> <p>æ›´å®Œå–„çš„Unicodeå­—ç¬¦ä¸²æ˜¯<code>IÃ±tÃ«rnÃ¢tiÃ´nÃ lizÃ¦tiÃ¸nâ˜ƒğŸ’©</code>ï¼Œè¿™20ä¸ªå­—ç¬¦åŒ…å«äº†ä»U+0100åˆ°U+FFFFçš„BMPå­—ç¬¦ï¼Œä»¥åŠä»U+010000åˆ°U+10FFFçš„éBMPå­—ç¬¦ã€‚</p></div></div> <div class="comment" data-v-63da4bd6><Vssue data-v-63da4bd6></Vssue></div></div></div> <div class="container" data-v-07c4fbe2 data-v-ad494eec>
  Designed by <a href="/about" data-v-07c4fbe2>Lishunyang</a> | <a href="https://beian.miit.gov.cn/" target="_blank" data-v-07c4fbe2>äº¬ICPå¤‡20009157å·</a> | All right reserved
</div></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.a48c4f56.js" defer></script><script src="/blog/assets/js/2.e0432708.js" defer></script><script src="/blog/assets/js/36.920da182.js" defer></script>
  </body>
</html>
